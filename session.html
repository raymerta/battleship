<html>
	<head>
		<title>BATTLESHIP</title>
		<link rel="stylesheet" type="text/css" href="http://parallemon.com/battleship/battleshipstyle.css">
		<!-- <link rel="stylesheet" type="text/css" href="battleshipstyle.css"> -->
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:100,300,400,700" rel="stylesheet">
	</head>

	<body>

		<div class="skybackground">
			<img src="http://parallemon.com/battleship/title.png">
		</div>
		<div class="seabackground">
			<div class="gamecontainer">
				
				<h1>Choose the game</h1>

				<a href="http://localhost:10001/game" onclick="openDialog()"><div class="gamebutton">New Game</div></a>

				<!-- <a href="http://localhost:10001/game"><div class="gamebutton">Baltic Sea 1</div></a>
				<a href="http://localhost:10001/game"><div class="gamebutton">Atlantic Sea 1</div></a>
				<a href="http://localhost:10001/game"><div class="gamebutton">Pacific Sea 1</div></a> -->

			</div>
		</div>

		<div id="newGameDialog" class="blackdrop" style="display: none;">
			<div class="newgamebox">
				<h1>Create New Game</h1>

				<table>
					<tr>
						<td>Number of players:</td>
						<td><input type="text" name="player" value="2" id="player"></td>
						<td><span>(max 5 players)</span></td>
					</tr>
					<tr>
						<td>Game Tile Size:</td>
						<td><input type="text" name="tiles" value="10" id="tiles"></td>
						<td><span>(max: 20 tiles)</span></td>
					</tr>
				</table>
				<a href="#" class="newgamecancel" onclick="closeDialog()">CANCEL</a><a href="#" class="newgamesubmit" onclick="createGame()">SUBMIT</a>
				<div class="clearfix"></div>
			</div>
		</div>

		<script type="text/javascript">

			var server = '';
			var uri = window.location.pathname.split('/');

			function getServerDetail() {
				
				var http = new XMLHttpRequest();
				var url = "http://localhost:10001/_getservername/" + uri[2];
				http.open("GET", url);

				//capture success response
				http.onreadystatechange = function() {
					if (http.readyState == 4 && http.status == 200) {
						server = JSON.parse(http.responseText);

						console.log(server.serverName);
						document.getElementById("serverName").innerHTML = server.serverName;
					}
				}

				http.send();
			}

			getServerDetail();

			function openDialog() {
				document.getElementById("newGameDialog").style.display = "block";
			}

			function closeDialog() {
				document.getElementById("newGameDialog").style.display = "none";	
			}

			function createGame() {
				
				var username = uri[3];
				var tiles = document.getElementById("tiles").value;
				var player = document.getElementById("player").value;

				var http = new XMLHttpRequest();
				var url = "http://localhost:10001/_insertname/";
				var params = username + ";" + server.serverId + ";" + server.serverUrl + ';' + tiles ';' + player;
				http.open("POST", url, true);

				//capture success response
				http.onreadystatechange = function() {
					if (http.readyState == 4 && http.status == 200) {
						window.location = http.responseText.trim();
					}
				}

				http.send(params);	
			}
		</script>

	</body>
</html>